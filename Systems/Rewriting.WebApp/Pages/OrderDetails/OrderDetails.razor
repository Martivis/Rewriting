@page "/order/{orderUid}"

@inject OrderDetailsService OrderDetailsService
@inject OrderOffersService OffersService

@if (_orderModel is null)
{

}
else
{
    <MudCard>
        <MudText Typo="Typo.h3">Order</MudText>
        <MudText>@_orderModel.Title</MudText>
        <MudText>@_orderModel.Text</MudText>
        <MudDivider />
        <MudText>@_orderModel.Comment</MudText>
        <MudText>@_orderModel.ClientName</MudText>
        <MudText>@_orderModel.PublishDate</MudText>
        <MudText>@_orderModel.Status</MudText>
    </MudCard>

    <MudCard>

        @if (_orderModel.ContractorUid is not null)
        {
            <MudText>Contractor: @_orderModel.ContractorName</MudText>
            <MudText>Contract publish date: @_orderModel.ContractPublishDate</MudText>
        }
        else
        {
            <ItemsList ItemService="OffersService">
                <OfferCard Model="@context" />    
            </ItemsList>
        }

    </MudCard>
}

@code {
    [Parameter]
    public string orderUid { get; set; }

    private Guid _uid;
    private OrderDetailsModel _orderModel;

    protected override async Task OnInitializedAsync()
    {
        _uid = Guid.Parse(orderUid);
        OffersService.OrderUid = _uid;

        _orderModel = await OrderDetailsService.GetOrderAsync(_uid);
    }
}
